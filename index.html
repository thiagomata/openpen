<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script src="./rgbColor.js"></script>
	<script src="./defaultFunctions.js"></script>
	<style>
		.line{
		clear: both;
		}
		.pixel{
		float: left;
		width: 10px;
		height: 10px;
		background-color: white;
		border-width: 1px;
		border-style: solid;
		border-color: black;
		}
		.debug {
			float: left;
			padding: 10px;
		}
	</style>
  </head>
  <body>
	<div id="paleta"></div>
	<br/>
	<br/>
	<div id="origem"></div>
	&lt;== click here
	<br/> 
	<br/>
	<div id="destino"></div>
	<br/>
	<br/>
	<div class="debug" id="debug-red"></div>
	<div class="debug"  id="debug-green"></div>
	<div class="debug"  id="debug-blue"></div>
	<br/>
	<br/>
	<script>
		var intWidth = 16;
		var intHeight = 16;
		var intThumbWidth = 11;
		var intThumbHeight = 20;

		function debugMatrix( arrMatrix, arrFixedMatrix, strColor ) {
			drawMatrix(
				{
					red:   strColor == 'red'   ? arrMatrix : createMatrix( arrMatrix.length, arrMatrix[0].length, 0 ), 
					green: strColor == 'green' ? arrMatrix : createMatrix( arrMatrix.length, arrMatrix[0].length, 0 ),
					blue:  strColor == 'blue'  ? arrMatrix : createMatrix( arrMatrix.length, arrMatrix[0].length, 0 )
				}, 
				document.getElementById( "debug-" + strColor  )
			)
			drawFixed( document.getElementById( "debug-" + strColor  ), arrFixedMatrix );
		}

		function drawFixed( objDivMatrix, arrFixedMatrix ) {
			var arrLines = objDivMatrix.childNodes;
			for( var y = 0; y < arrLines.length ; y++ )
			{
				var objLine = arrLines[y];
				var arrPixels = objLine.getElementsByTagName("span");

				for( var x = 0; x < arrPixels.length ; x++ )
				{
					var objPixel = arrPixels[x];
					if( arrFixedMatrix[x][y] == 1) {
						objPixel.style.borderWidth = "1px";
						objPixel.style.borderColor = "white";
						objPixel.style.borderStyle = "solid";
					}
				}
			}			
		}
		function pickColor( arrMatrix, x, y, notFound ) {
			if( arrMatrix[x] == null ) {
				return notFound;
			}
			if( arrMatrix[x][y] == null ) {
				return notFound;
			}
			return arrMatrix[x][y];
		}

		function drawMatrix( objMatrixRGB, objDiv ) {
			console.log( "drawMatrix ", objMatrixRGB );
			objDiv.innerHTML = "";
			var arrMatrixRed   = objMatrixRGB.red;
			var arrMatrixGreen = objMatrixRGB.green;
			var arrMatrixBlue  = objMatrixRGB.blue;
			for( var y = 0; y < arrMatrixRed[0].length; y++ )
			{
				var objLine = document.createElement("div");
				objLine.className = "line";

				for( var x = 0; x < arrMatrixRed.length; x++ )
				{
					var intRed   = Math.round(pickColor(arrMatrixRed, x, y, 255) );
					var intGreen = Math.round(pickColor(arrMatrixGreen, x, y, 0) );
					var intBlue  = Math.round(pickColor(arrMatrixBlue, x, y, 0) );
					var objPixel = document.createElement("span");
					objPixel.className = "pixel";
					objLine.appendChild(objPixel);
					objPixel.style.backgroundColor = "rgb("+intRed+","+intGreen+","+intBlue+")";
					objPixel.title = "["+x+","+y+"] rgb("+intRed+","+intGreen+","+intBlue+")";
					objLine.appendChild( objPixel );
				}
				objDiv.appendChild(objLine);
			}			
		}

		function makePallete() {
			var intColors = 10;
			var arrColors = Array();
			for( var intColor = 0; intColor < 255; intColor += intColors )
			{
				arrColors.push( Array( intColor , intColor , intColor ) );
			}
			for( var intColor = 0; intColor < 255; intColor += intColors )
			{
				arrColors.push( Array( 255 - intColor , 255 - intColor , intColor ) );
			}
			for( var intColor = 0; intColor < 255; intColor += intColors )
			{
				arrColors.push( Array( intColor , 255 - intColor , 255 - intColor ) );
			}
			for( var intColor = 0; intColor < 255; intColor += intColors )
			{
				arrColors.push( Array( 255 - intColor , intColor , 255 - intColor ) );
			}

			for( var intElement = 0; intElement < arrColors.length; intElement++ )
			{
				var objPencil = document.createElement("span");
				objPencil.className = "pixel";
				objPencil.style.backgroundColor = "rgb(" + arrColors[intElement].join() + ")";
				objPencil.onclick = function(){ window.pencilColor = this.style.backgroundColor };
				document.getElementById("paleta").appendChild(objPencil);
			}
			window.pencilColor = "rgb(255,0,0)";
		}

		makePallete();

                window.draw = function() 
                {
                    for( var x = 0; x < intWidth; x++ )
                    {
                            var objLine = document.createElement("div");
                            objLine.className = "line";
                            for( var y = 0; y <  intHeight; y++ )
                            {
                                    var objPixel = document.createElement("span");
                                    var dy = (y - intHeight / 2);
                                    var dx = (x - intWidth / 2);
                                    var distance = Math.sqrt( dx*dx + dy*dy );
                                    var radio = 7;
                                    if( distance < Math.round(radio) ) {
                                        var color = Math.round( 255 * ( 1 - distance/(radio+1) ) );
                                        console.log("color=",color);
                                        var rgbColor = "rgb("+color+","+color+","+color+")";
                                        console.log(rgbColor);
                                        objPixel.style.backgroundColor = rgbColor;
                                    } else if ( x > intWidth * 0.6 ) {
                                        objPixel.style.backgroundColor = "rgb(0,0," + Math.round( 200 * x / intWidth ) + ")"  ;
                                    }
                                    objPixel.className = "pixel";
                                    objLine.appendChild(objPixel);
                                    objPixel.onclick = function(){ this.style.backgroundColor = window.pencilColor; window.makeThumbnail() };
                            }
                            document.getElementById("origem").appendChild( objLine );
                    }
                    window.makeThumbnail();
                }
                
		window.makeThumbnail = function makeThumbnail()
		{
			var arrMatrixRed = createMatrix( intWidth, intHeight , 0);
			var arrMatrixGreen = createMatrix( intWidth, intHeight , 0);
			var arrMatrixBlue = createMatrix( intWidth, intHeight, 0 );
			var arrLines = document.getElementById("origem").childNodes;
			for( var y = 0; y < arrLines.length ; y++ )
			{
				var objLine = arrLines[y];
				var arrPixels = objLine.getElementsByTagName("span");

				for( var x = 0; x < arrPixels.length ; x++ )
				{
					var objPixel = arrPixels[x];
					var strColor = objPixel.style.backgroundColor;
					if( strColor == false )
					{
						strColor = "rgb(255,255,255)";
					}
					var objColor = new RGBColor( strColor );
					arrMatrixRed[x][y]   = objColor.r;
					arrMatrixGreen[x][y] = objColor.g;
					arrMatrixBlue[x][y]  = objColor.b;
				}
			}

			var objThumbMatrix =  expandMatrixRGB(
				{
					red:arrMatrixRed,
					green:arrMatrixGreen,
					blue:arrMatrixBlue
				},
				intThumbWidth,
				intThumbHeight
			);

			drawMatrix( 
				objThumbMatrix, 
				document.getElementById("destino")
			);
		}
                window.draw();
	</script>
  </body>
</html>
